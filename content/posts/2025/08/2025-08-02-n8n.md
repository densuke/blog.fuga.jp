---
layout: post
title:  "【遅すぎ】n8nに入門してみた(最初からセルフホスト)"
date:   2025-08-02 06:19:14+0900
categories: [自動化, n8n, AI]
---
遅まきながら、n8nに入門してみました。
n8nはオープンソースのワークフロー自動化ツールです。ブロックくっつけるタイプのやつで、用意されているブロックを利用して各種の処理を繋げていけるのですが、こと最近だと"AI Agent"というブロックの力でけっこう力技で処理ができるということに気づきました。

ということで、重い腰を上げて、セルフホスト上で走らせるということを試しています。
実は道半ばのところがあるのですが、ある程度書いておきたいと思います。

![](/images/2025-08-02/Gemini_Generated_Image_lbx6sblbx6sblbx6.png)

<!--more-->

<div class="booklink-box" style="text-align:left;padding-bottom:20px;font-size:small;zoom: 1;overflow: hidden;"><div class="booklink-image" style="float:left;margin:0 15px 10px 0;"><a href="//af.moshimo.com/af/c/click?a_id=1175594&p_id=56&pc_id=56&pl_id=637&s_v=b5Rz2P0601xu&url=http%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15689930%2F%3Frafcid%3Dwsc_b_bs_1051722217600006323" target="_blank" ><img src="https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/7001/9784840467001.jpg?_ex=200x200" style="border: none;" /></a><img src="//i.moshimo.com/af/i/impression?a_id=1175594&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;"></div><div class="booklink-info" style="line-height:120%;zoom: 1;overflow: hidden;"><div class="booklink-name" style="margin-bottom:10px;line-height:120%"><a href="//af.moshimo.com/af/c/click?a_id=1175594&p_id=56&pc_id=56&pl_id=637&s_v=b5Rz2P0601xu&url=http%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15689930%2F%3Frafcid%3Dwsc_b_bs_1051722217600006323" target="_blank" >透析ケア（2019　8（Vol．25　N）</a><img src="//i.moshimo.com/af/i/impression?a_id=1175594&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;"><div class="booklink-powered-date" style="font-size:8pt;margin-top:5px;font-family:verdana;line-height:120%">posted with <a href="https://yomereba.com" rel="nofollow" target="_blank">ヨメレバ</a></div></div><div class="booklink-detail" style="margin-bottom:5px;"> メディカ出版 2019年08月    </div><div class="booklink-link2" style="margin-top:10px;"><div class="shoplinkrakuten" style="display:inline;margin-right:5px"><a href="//af.moshimo.com/af/c/click?a_id=1175594&p_id=56&pc_id=56&pl_id=637&s_v=b5Rz2P0601xu&url=http%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F15689930%2F%3Frafcid%3Dwsc_b_bs_1051722217600006323" target="_blank" >楽天ブックス</a><img src="//i.moshimo.com/af/i/impression?a_id=1175594&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;"></div><div class="shoplinkamazon" style="display:inline;margin-right:5px"><a href="//af.moshimo.com/af/c/click?a_id=920708&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2F4840467005" target="_blank" >Amazon</a></div><div class="shoplinkkindle" style="display:inline;margin-right:5px"><a href="//af.moshimo.com/af/c/click?a_id=920708&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fwww.amazon.co.jp%2Fgp%2Fsearch%3Fkeywords%3D%25E9%2580%258F%25E6%259E%2590%25E3%2582%25B1%25E3%2582%25A2%25EF%25BC%25882019%25E3%2580%25808%25EF%25BC%2588Vol%25EF%25BC%258E25%25E3%2580%2580N%25EF%25BC%2589%26__mk_ja_JP%3D%2583J%2583%255E%2583J%2583i%26url%3Dnode%253D2275256051" target="_blank" >Kindle</a></div>                              	  	  	  	  	</div></div><div class="booklink-footer" style="clear: left"></div></div>

※ "n8n"で書籍検索したらこれが出るんだもんw もう少し健康に気遣えという戒めですか?

## n8nとは

n8nは、OSSのワークフロー自動化ツールです。ノーコードでブロックを組み合わせて処理を自動化できます。最近ではAIエージェントの機能が強化され、AIを活用した高度な自動化も可能になっています。

- n8nの公式サイト: [n8n.io](https://n8n.io/)

ホスティング版もあるのですが、実はOSSで開発されており、ソースを引っ張ってくればセルフホストで使えるようになっています。

- n8nのGitHubリポジトリ: [n8n/n8n](https://github.com/n8n-io/n8n)

なので、これを自分のサーバー上で走らせればそれなりに動かせてしまいます。
ということで、GCPのAlways Free枠で動かしているょゎょゎなサーバー上で構築してみました。

## 導入手順

Dockerによるイメージも配布されているのですが、低スペックすぎて下手にコンテナを組み込むとマトモに動けないという状況だったので、ソースを取得して直接走らせる形にしておきます。

大雑把な手順はたいしたことありません。
設置したいサーバーにログインしてから…

1. 適当なディレクトリにてソースのクローン
2. Node.jsのインストール
3. **pnpm** をインストールします。ここすごく重要。
4. pnpmを使って依存関係のインストール
5. n8nの起動

ここまでが軌道までのステップです。
n8n自体はNode.jsで動くのですが、npmでは必要なモジュールを入れている最中にエラー(?)で停止していまいました。
workspaceがうんたらかんたらという感じでしたが、理由はわかりませんが、pnpmだとインストールできるという情報を得てそちらで対応しました。
そうすればn8n自体は起動します。

## リバースプロキシで繋ぐ

n8n自体はローカルでポート5678で動いているため、リバースプロキシでブラウザからコントロールできるようにしておきましょう。
ここではCaddyを使ってリバースプロキシの構築です。

1. n8n用にホストを設定する(DNSサーバーに登録しておく)
2. Caddyfile(普通に入れていれば `/etc/caddy/Caddyfile`)に以下のような設定を追加
    ```caddyfile
    n8n.example.com:443 {
    reverse_proxy localhost:5678
    }
    ```
3. Caddyを再起動すればOK

これで指定ホストに繋ぐと、Caddyは偉いのでLet's EncryptでSSL証明書を作成してTLSによる接続でn8nにアクセスできるようになります。

## あとはワークフローを作るだけ

ということでゴリゴリとワークフローを作って研鑽の日々です。

現在は、

- 朝起きた時間にぐらいに自動でワークフローを回してお仕事の予定と天気をDiscordの個人チャネルに送る
- RSS,Atomのフィード解析から新着記事を取得して見出しを要約し、カテゴライズしてDiscordの個人チャネルに送る(英文記事であれば見出しの翻訳も入れる)

というぐらいで動いています。
無駄にでかいワークフロー図はこうなっております。改善の余地はまだまだあるはず。

![フィードカテゴライズ配信の例](/images/2025-08-02/image.png)

途中にAI Agentを入れることで、翻訳や要約、カテゴライズを任せることができるようになっています。
若干コスト発生しますが、Google Ai StudioのAPIでは、Gemini 2.5 Flashには無料枠がある程度あるみたいなので、そこである程度まかなってもらいましょう。
